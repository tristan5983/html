<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Lucky Slots Casino</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babylon/5.57.1/babylon.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a0033 0%, #4a0080 100%);
            overflow: hidden;
            color: #fff;
        }

        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
            position: fixed;
            top: 0;
            left: 0;
        }

        .ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }

        .casino-header {
            text-align: center;
            padding: 20px;
            pointer-events: auto;
        }

        .casino-header h1 {
            font-size: 3em;
            text-shadow: 0 0 20px #ffd700, 0 0 40px #ffd700;
            color: #ffd700;
            margin-bottom: 10px;
        }

        .balance-display {
            text-align: center;
            font-size: 1.8em;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            margin-bottom: 10px;
        }

        .controls-container {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
            pointer-events: auto;
        }

        .bet-controls {
            display: flex;
            align-items: center;
            gap: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 30px;
            border-radius: 50px;
            border: 2px solid #ffd700;
            backdrop-filter: blur(10px);
        }

        .bet-controls button {
            background: #4a0080;
            color: #fff;
            border: 2px solid #ffd700;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .bet-controls button:hover {
            background: #6a00a0;
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .bet-amount {
            font-size: 1.5em;
            color: #ffd700;
            min-width: 120px;
            text-align: center;
            font-weight: bold;
        }

        .spin-button {
            background: linear-gradient(145deg, #ff4444, #cc0000);
            color: #fff;
            border: 4px solid #ffd700;
            padding: 25px 80px;
            font-size: 2em;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(255, 68, 68, 0.5);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .spin-button:hover:not(:disabled) {
            background: linear-gradient(145deg, #ff6666, #ee0000);
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(255, 68, 68, 0.7);
        }

        .spin-button:disabled {
            background: #666;
            cursor: not-allowed;
            box-shadow: none;
            border-color: #999;
        }

        .message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3em;
            font-weight: bold;
            text-align: center;
            padding: 30px 60px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 20px;
            border: 3px solid #ffd700;
            display: none;
            pointer-events: none;
            z-index: 200;
        }

        .message.show {
            display: block;
            animation: messagePopup 0.5s ease-out;
        }

        .message.win {
            color: #00ff00;
            text-shadow: 0 0 20px #00ff00;
            animation: messagePopup 0.5s ease-out, pulse 0.5s ease-in-out infinite;
        }

        @keyframes messagePopup {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }

        .paytable {
            position: fixed;
            top: 120px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #ffd700;
            pointer-events: auto;
            backdrop-filter: blur(10px);
            max-width: 250px;
        }

        .paytable h3 {
            text-align: center;
            margin-bottom: 15px;
            color: #ffd700;
            font-size: 1.2em;
        }

        .paytable-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 215, 0, 0.3);
            font-size: 0.9em;
        }

        .symbols {
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <canvas id="renderCanvas"></canvas>
    
    <div class="ui-overlay">
        <div class="casino-header">
            <h1>üé∞ 3D LUCKY SLOTS üé∞</h1>
            <div class="balance-display">
                Balance: $<span id="balance">1000</span>
            </div>
        </div>

        <div class="controls-container">
            <div class="bet-controls">
                <button onclick="decreaseBet()">-</button>
                <div class="bet-amount">BET: $<span id="bet">10</span></div>
                <button onclick="increaseBet()">+</button>
            </div>
            <button class="spin-button" onclick="spin()" id="spinBtn">SPIN</button>
        </div>

        <div class="message" id="message"></div>

        <div class="paytable">
            <h3>üí∞ PAYTABLE üí∞</h3>
            <div class="paytable-item">
                <span class="symbols">üçí üçí üçí</span>
                <span>50x</span>
            </div>
            <div class="paytable-item">
                <span class="symbols">üçã üçã üçã</span>
                <span>40x</span>
            </div>
            <div class="paytable-item">
                <span class="symbols">üçä üçä üçä</span>
                <span>30x</span>
            </div>
            <div class="paytable-item">
                <span class="symbols">üçá üçá üçá</span>
                <span>25x</span>
            </div>
            <div class="paytable-item">
                <span class="symbols">‚≠ê ‚≠ê ‚≠ê</span>
                <span>20x</span>
            </div>
            <div class="paytable-item">
                <span class="symbols">üíé üíé üíé</span>
                <span>100x</span>
            </div>
            <div class="paytable-item">
                <span class="symbols">7Ô∏è‚É£ 7Ô∏è‚É£ 7Ô∏è‚É£</span>
                <span>75x</span>
            </div>
            <div class="paytable-item">
                <span>Any 2 Match</span>
                <span>2x</span>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById("renderCanvas");
        const engine = new BABYLON.Engine(canvas, true);
        
        let balance = 1000;
        let currentBet = 10;
        let isSpinning = false;
        let reelMeshes = [];
        let symbolTextures = [];
        
        const symbols = ['üçí', 'üçã', 'üçä', 'üçá', '‚≠ê', 'üíé', '7Ô∏è‚É£'];
        const payouts = {
            'üçíüçíüçí': 50,
            'üçãüçãüçã': 40,
            'üçäüçäüçä': 30,
            'üçáüçáüçá': 25,
            '‚≠ê‚≠ê‚≠ê': 20,
            'üíéüíéüíé': 100,
            '7Ô∏è‚É£7Ô∏è‚É£7Ô∏è‚É£': 75
        };

        const createScene = function () {
            const scene = new BABYLON.Scene(engine);
            scene.clearColor = new BABYLON.Color4(0.1, 0, 0.2, 1);

            // Camera
            const camera = new BABYLON.ArcRotateCamera("camera", -Math.PI / 2, Math.PI / 2.5, 15, new BABYLON.Vector3(0, 0, 0), scene);
            camera.attachControl(canvas, true);
            camera.lowerRadiusLimit = 10;
            camera.upperRadiusLimit = 25;
            camera.lowerBetaLimit = Math.PI / 3;
            camera.upperBetaLimit = Math.PI / 1.8;

            // Lights
            const hemisphericLight = new BABYLON.HemisphericLight("hemiLight", new BABYLON.Vector3(0, 1, 0), scene);
            hemisphericLight.intensity = 0.6;

            const spotLight = new BABYLON.SpotLight("spotLight", new BABYLON.Vector3(0, 10, -5), new BABYLON.Vector3(0, -1, 0.5), Math.PI / 3, 2, scene);
            spotLight.intensity = 1.5;
            spotLight.diffuse = new BABYLON.Color3(1, 0.95, 0.8);

            // Slot machine frame
            createSlotMachineFrame(scene);

            // Create reels
            createReels(scene);

            // Particle system for wins
            createParticleSystem(scene);

            return scene;
        };

        function createSlotMachineFrame(scene) {
            // Base
            const base = BABYLON.MeshBuilder.CreateBox("base", {width: 12, height: 0.5, depth: 6}, scene);
            base.position.y = -3;
            const baseMat = new BABYLON.StandardMaterial("baseMat", scene);
            baseMat.diffuseColor = new BABYLON.Color3(0.1, 0, 0.2);
            baseMat.specularColor = new BABYLON.Color3(0.3, 0.3, 0.3);
            base.material = baseMat;

            // Back panel
            const backPanel = BABYLON.MeshBuilder.CreateBox("backPanel", {width: 11, height: 8, depth: 0.5}, scene);
            backPanel.position.z = -2.5;
            backPanel.position.y = 1;
            const backMat = new BABYLON.StandardMaterial("backMat", scene);
            backMat.diffuseColor = new BABYLON.Color3(0.2, 0, 0.3);
            backMat.emissiveColor = new BABYLON.Color3(0.05, 0, 0.1);
            backPanel.material = backMat;

            // Top decoration
            const top = BABYLON.MeshBuilder.CreateCylinder("top", {height: 1, diameter: 3}, scene);
            top.position.y = 5.5;
            top.rotation.z = Math.PI / 2;
            const topMat = new BABYLON.StandardMaterial("topMat", scene);
            topMat.diffuseColor = new BABYLON.Color3(1, 0.84, 0);
            topMat.emissiveColor = new BABYLON.Color3(0.3, 0.25, 0);
            top.material = topMat;

            // Gold trim
            for (let i = -1; i <= 1; i++) {
                const trim = BABYLON.MeshBuilder.CreateTorus("trim", {diameter: 3, thickness: 0.1}, scene);
                trim.position.x = i * 3.5;
                trim.position.y = 1;
                trim.position.z = -1;
                const trimMat = new BABYLON.StandardMaterial("trimMat", scene);
                trimMat.diffuseColor = new BABYLON.Color3(1, 0.84, 0);
                trimMat.emissiveColor = new BABYLON.Color3(0.2, 0.15, 0);
                trim.material = trimMat;
            }
        }

        function createReels(scene) {
            const positions = [-3.5, 0, 3.5];
            
            for (let i = 0; i < 3; i++) {
                const reel = BABYLON.MeshBuilder.CreateCylinder("reel" + i, {
                    height: 5,
                    diameter: 2.5,
                    tessellation: 32
                }, scene);
                
                reel.position.x = positions[i];
                reel.position.y = 1;
                reel.rotation.z = Math.PI / 2;
                
                const reelMat = new BABYLON.StandardMaterial("reelMat" + i, scene);
                reelMat.diffuseColor = new BABYLON.Color3(0.1, 0.1, 0.1);
                reelMat.specularColor = new BABYLON.Color3(0.5, 0.5, 0.5);
                reel.material = reelMat;
                
                // Create dynamic texture for symbols
                const dynamicTexture = new BABYLON.DynamicTexture("symbolTexture" + i, {width: 512, height: 512}, scene);
                const textureContext = dynamicTexture.getContext();
                
                const symbolPlane = BABYLON.MeshBuilder.CreatePlane("symbolPlane" + i, {width: 2, height: 2}, scene);
                symbolPlane.position.x = positions[i];
                symbolPlane.position.y = 1;
                symbolPlane.position.z = 1.3;
                
                const planeMat = new BABYLON.StandardMaterial("planeMat" + i, scene);
                planeMat.diffuseTexture = dynamicTexture;
                planeMat.emissiveColor = new BABYLON.Color3(1, 1, 1);
                symbolPlane.material = planeMat;
                
                reelMeshes.push({
                    cylinder: reel,
                    plane: symbolPlane,
                    texture: dynamicTexture,
                    currentSymbol: symbols[0],
                    targetRotation: 0,
                    spinning: false
                });
                
                updateReelSymbol(i, symbols[0]);
            }
        }

        function updateReelSymbol(reelIndex, symbol) {
            const reel = reelMeshes[reelIndex];
            const texture = reel.texture;
            const ctx = texture.getContext();
            
            ctx.fillStyle = "#000000";
            ctx.fillRect(0, 0, 512, 512);
            
            ctx.font = "bold 300px Arial";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(symbol, 256, 256);
            
            texture.update();
            reel.currentSymbol = symbol;
        }

        function createParticleSystem(scene) {
            const particleSystem = new BABYLON.ParticleSystem("particles", 2000, scene);
            particleSystem.particleTexture = new BABYLON.Texture("https://www.babylonjs.com/assets/Flare.png", scene);
            
            particleSystem.emitter = new BABYLON.Vector3(0, 1, 0);
            particleSystem.minEmitBox = new BABYLON.Vector3(-5, 0, -2);
            particleSystem.maxEmitBox = new BABYLON.Vector3(5, 0, 2);
            
            particleSystem.color1 = new BABYLON.Color4(1, 0.84, 0, 1);
            particleSystem.color2 = new BABYLON.Color4(1, 0.5, 0, 1);
            particleSystem.colorDead = new BABYLON.Color4(0.5, 0, 0, 0);
            
            particleSystem.minSize = 0.1;
            particleSystem.maxSize = 0.5;
            
            particleSystem.minLifeTime = 0.5;
            particleSystem.maxLifeTime = 1.5;
            
            particleSystem.emitRate = 500;
            particleSystem.gravity = new BABYLON.Vector3(0, -5, 0);
            
            particleSystem.direction1 = new BABYLON.Vector3(-2, 8, 2);
            particleSystem.direction2 = new BABYLON.Vector3(2, 8, -2);
            
            particleSystem.minAngularSpeed = 0;
            particleSystem.maxAngularSpeed = Math.PI;
            
            particleSystem.minEmitPower = 1;
            particleSystem.maxEmitPower = 3;
            particleSystem.updateSpeed = 0.01;
            
            window.particleSystem = particleSystem;
        }

        const scene = createScene();

        engine.runRenderLoop(function () {
            // Animate spinning reels
            reelMeshes.forEach(reel => {
                if (reel.spinning) {
                    reel.cylinder.rotation.x += 0.5;
                }
            });
            
            scene.render();
        });

        window.addEventListener("resize", function () {
            engine.resize();
        });

        function updateDisplay() {
            document.getElementById('balance').textContent = balance;
            document.getElementById('bet').textContent = currentBet;
        }

        function increaseBet() {
            if (currentBet < balance && currentBet < 100) {
                currentBet += 10;
                updateDisplay();
            }
        }

        function decreaseBet() {
            if (currentBet > 10) {
                currentBet -= 10;
                updateDisplay();
            }
        }

        function getRandomSymbol() {
            return symbols[Math.floor(Math.random() * symbols.length)];
        }

        function spin() {
            if (isSpinning || balance < currentBet) {
                if (balance < currentBet) {
                    showMessage('Insufficient Balance!', false);
                }
                return;
            }

            isSpinning = true;
            balance -= currentBet;
            updateDisplay();
            
            const spinBtn = document.getElementById('spinBtn');
            spinBtn.disabled = true;

            // Start spinning animation
            reelMeshes.forEach(reel => {
                reel.spinning = true;
            });

            // Stop reels one by one
            const results = [];
            const delays = [1500, 2000, 2500];
            
            delays.forEach((delay, index) => {
                setTimeout(() => {
                    const symbol = getRandomSymbol();
                    results.push(symbol);
                    reelMeshes[index].spinning = false;
                    updateReelSymbol(index, symbol);
                    
                    if (index === 2) {
                        setTimeout(() => checkResults(results), 500);
                    }
                }, delay);
            });
        }

        function checkResults(results) {
            const resultString = results.join('');
            let winAmount = 0;

            if (payouts[resultString]) {
                winAmount = currentBet * payouts[resultString];
                balance += winAmount;
                showMessage(`üéâ JACKPOT! +$${winAmount} üéâ`, true);
                window.particleSystem.start();
                setTimeout(() => window.particleSystem.stop(), 3000);
            } else if (results[0] === results[1] || results[1] === results[2] || results[0] === results[2]) {
                winAmount = currentBet * 2;
                balance += winAmount;
                showMessage(`Nice! +$${winAmount}`, true);
            } else {
                showMessage('Try Again!', false);
            }

            updateDisplay();
            
            setTimeout(() => {
                isSpinning = false;
                document.getElementById('spinBtn').disabled = false;
                hideMessage();
            }, 2500);
        }

        function showMessage(text, isWin) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = isWin ? 'message show win' : 'message show';
        }

        function hideMessage() {
            const messageEl = document.getElementById('message');
            messageEl.className = 'message';
        }

        updateDisplay();
    </script>
</body>
</html>
